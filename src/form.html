<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Koko's Commands Box</title>
    <style>
      body,
      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: auto;
        min-height: 0;
        margin: 0;
        padding: 0;
      }
      input {
        width: 100%;
        height: 100%;
        font-size: 16px;
        position: absolute;
        top: 0;
        left: 0;
        border: none;
        outline: none;
      }

      #search {
        z-index: 2;
        background-color: transparent;
      }

      #autocomplete,
      #argsInput {
        opacity: 0.6;
        z-index: 1;
        pointer-events: none;
        font-weight: 100;
      }

      #argsInput {
        color: #ff9100;
      }
    </style>
  </head>
  <body>
    <input id="search" type="text" autofocus />
    <input id="autocomplete" type="text" disabled />
    <input id="argsInput" type="text" disabled />

    <script>
      const { ipcRenderer } = require("electron");
      const input = document.getElementById("search");
      const autocomplete = document.getElementById("autocomplete");
      let tabsCount = 0;

      // Listen for autocomplete results
      ipcRenderer.on(
        "autocomplete-result",
        (_event, { key, args, isTabPress }) => {
          autocomplete.value = key;
          argsInput.value = `${autocomplete.value}${
            args.length > 0 ? ` [${args.join(", ")}]` : ""
          }`;

          if (isTabPress) {
            search.value = autocomplete.value + " ";
          }
        }
      );

      // Request autocomplete on input
      input.addEventListener("input", (e) => {
        tabsCount = 0;
        ipcRenderer.send("autocomplete-request", { searchValue: input.value });
      });

      // When Enter is pressed, send value and close
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          ipcRenderer.send("input-value", input.value);
        }
      });

      // Optional: press Escape to cancel
      input.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ipcRenderer.send("input-value", null);
        }
      });

      // Tab key autocomplete
      input.addEventListener("keydown", (e) => {
        if (e.key === "Tab") {
          e.preventDefault();
          if (!autocomplete.value) return;
          tabsCount++;
          if (tabsCount > 1) {
            input.value = "";
            autocomplete.value = "";
            argsInput.value = "";
            return;
          }
          ipcRenderer.send("autocomplete-request", {
            searchValue: input.value,
            isTabPress: true,
          });
        }
      });
    </script>
  </body>
</html>
