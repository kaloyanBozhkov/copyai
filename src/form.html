<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Koko's Commands Box</title>
    <style>
      body,
      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: auto;
        min-height: 0;
        margin: 0;
        padding: 0;
        background: transparent;
        background-color: transparent;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      input {
        width: 100%;
        height: 100%;
        border: none;
        outline: none;
        padding-left: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        pointer-events: auto;
        font-size: 16px;
        font-weight: 100;
        background-color: transparent;
        pointer-events: auto;
      }

      #search {
        position: relative;
        top: -1px;
        z-index: 3;
      }

      #autocomplete {
        z-index: -1;
      }

      #argsInput {
        z-index: -2;
        background-color: white;
      }

      #autocomplete,
      #argsInput {
        position: absolute;
        inset: 0;
        margin: auto;
        opacity: 0.6;
        pointer-events: none;
      }

      #argsInput {
        color: #ff9100;
      }

      #cmdInput {
        position: relative;
        width: 400px;
        height: 30px;
        pointer-events: auto;
      }

      .center {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        pointer-events: none;
      }

      p {
        pointer-events: none;
        font-size: 12px;
        color: #666;
        margin: 0;
        padding: 0;
        font-weight: 100;
        text-align: right;
        margin-top: 14px;
      }
    </style>
  </head>
  <body>
    <div class="center">
      <div id="cmdInput">
        <input id="search" type="text" autofocus />
        <input id="autocomplete" type="text" disabled />
        <input id="argsInput" type="text" disabled />
        <p>Made with â™¥ by Koko</p>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require("electron");
      const input = document.getElementById("search");
      const autocomplete = document.getElementById("autocomplete");
      const cmdInput = document.getElementById("cmdInput");
      let tabsCount = 0;

      ipcRenderer.on("env-config", (_event, { isDevMode }) => {
        if (isDevMode) {
         const madeBy =  document.querySelector("p");
         madeBy.innerText += " (dev)";
        }
      });

      // Handle mouse enter/leave for click-through
      cmdInput.addEventListener("mouseenter", () => {
        ipcRenderer.send("mouse-enter");
      });
      cmdInput.addEventListener("mouseleave", () => {
        ipcRenderer.send("mouse-leave");
      });

      // Listen for autocomplete results
      ipcRenderer.on(
        "autocomplete-result",
        (_event, { key, args, isTabPress }) => {
          autocomplete.value = key;
          argsInput.value = `${autocomplete.value}${
            args.length > 0 ? ` [${args.join(", ")}]` : ""
          }`;

          if (isTabPress) {
            search.value = autocomplete.value + " ";
          }
        }
      );

      // Request autocomplete on input
      input.addEventListener("input", (e) => {
        tabsCount = 0;
        ipcRenderer.send("autocomplete-request", { searchValue: input.value });
      });

      // When Enter is pressed, send value and close
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          ipcRenderer.send("input-value", input.value);
        }
      });

      // Optional: press Escape to cancel
      input.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ipcRenderer.send("input-value", null);
        }
      });

      // Tab key autocomplete
      input.addEventListener("keydown", (e) => {
        if (e.key === "Tab") {
          e.preventDefault();
          if (!autocomplete.value) return;
          tabsCount++;
          if (tabsCount > 1) {
            input.value = "";
            autocomplete.value = "";
            argsInput.value = "";
            return;
          }
          ipcRenderer.send("autocomplete-request", {
            searchValue: input.value,
            isTabPress: true,
          });
        }
      });
    </script>
  </body>
</html>